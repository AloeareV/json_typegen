<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>JSON -> Rust (type generation)</title>
    <script src="https://cdn.polyfill.io/v2/polyfill.js?features=Promise,fetch" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/rust.min.js" charset="utf-8"></script>
    <script type="text/javascript">
      hljs.configure({
        languages: ['rust']
      });
      function generate() {
        fetch('api', {
          method: 'POST',
          body: JSON.stringify({
            name: document.querySelector('#name').value || 'Sample',
            input: document.querySelector('#input').value || '{}',
            runnable: document.querySelector('#runnable').checked
          })
        }).then(function(res) {
          return Promise.all([res.status, res.text()]);
        }).then(function(res) {
          var status = res[0];
          var code = res[1];
          var outnode = document.querySelector('#output code');
          outnode.textContent = code;
          if (status < 300) {
            hljs.highlightBlock(outnode);
            document.querySelector('#output-footer').innerHTML =
              '<a href="http://play.integer32.com/?code='
              + encodeURIComponent(code)
              + '">Open code in Rust Playground</a>';
          } else {
            document.querySelector('#output-footer').innerHTML = '';
          }
        }).catch(function(error) {
          console.log('Error: ' + error.message);
        });
      }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/idea.min.css">
    <style media="screen">
      body {
        max-width: 600px;
        margin: auto;
      }
      #name {
        width: 100%;
      }
      #input {
        width: 100%;
        height: 300px;
        font-family: monospace;
      }
      #output {
        font-family: monospace;
        white-space: pre;
      }
    </style>
  </head>
  <body>
    <h2>Input</h2>
    <input id="name" placeholder="Root struct name">
    <textarea id="input"
              placeholder="Paste JSON here..."></textarea>
    <input type="checkbox" id="runnable">
    <label for="runnable">Generate runnable example</label>
    <button onclick="generate();">Generate Rust types</button>

    <h2>Output</h2>
    <pre id="output"><code></code></pre>
    <div id="output-footer"></div>
  </body>
</html>
